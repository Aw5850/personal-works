var cirru, indent, paint, q, req, source_file;

source_file = "./cirru/demo.cirru";

indent = require('textarea-indent');

q = function(query) {
  return document.querySelector(query);
};

cirru = require("./parser");

req = new XMLHttpRequest;

req.open("get", source_file);

req.send();

req.onload = function() {
  q("textarea.source").value = req.response;
  q("textarea.source").focus();
  return paint(req.response);
};

paint = function(text) {
  var res;
  res = cirru.pare(text, source_file);
  console.log(res);
  return q("textarea.target").value = JSON.stringify(res, null, 2);
};

q("textarea.source").onkeyup = function() {
  return paint(this.value);
};

q("textarea.source").onchange = function() {
  return paint(this.value);
};

q('textarea.source').addEventListener('keydown', indent.newlineHandler);
